# Медианный фильтр для фильтрации шума "Соль и перец"

Ссылка на **https://colab.research.google.com/drive/1lP658twfp1JgtdjH0hgBfe0l_wIdcnY8?usp=sharing**

### Результаты:
Изображение 128х128: 

![Изображение 128х128](https://github.com/vmokook/HPC-2023/blob/main/Salt_and_Paper/images/128.png)

Изображение 256х256: 

![Изображение 256х256](https://github.com/vmokook/HPC-2023/blob/main/Salt_and_Paper/images/256.png)

Изображение 512х512: 

![Изображение 512х512](https://github.com/vmokook/HPC-2023/blob/main/Salt_and_Paper/images/512.png)

Изображение 1024х1024: 

![Изображение 1024х1024](https://github.com/vmokook/HPC-2023/blob/main/Salt_and_Paper/images/1024.png)

Изображение 2048х2048: 

![Изображение 2048х2048](https://github.com/vmokook/HPC-2023/blob/main/Salt_and_Paper/images/2048.png)

### Алгоритм работы: 
1. Загружаем изображение, накладываем на него шум при помощи функции `add_noise`
2. Изменяем размер изображения и производим фильтрацию шума "Соль и перец" с помощью функции `median_filter_cpu`.
3. Внутри функции `median_filter_cpu` реализован 9-точечный медианный фильтр. Вложенные циклы по i и j for
   пробегают каждый пиксель изображения, за исключением краевых пикселей. Для обработки краев реализованы циклы по x и y.
4. Формируется маска фильтра размером 3х3
5. Элементы маски сортируются в порядке возрастания, выбирается медианный элемент (5-ый по порядку) и это значение присваивается
соответствующему пикселю выходного изображения
6. Аналогичным образом реализовано в функции `median_filter_gpu` (подробнее в разделе "Как происходила фильтрация на GPU?")
7. Для фильтрации на GPU формируется ядро, затем уже происходит фильтрация.
8. Вывод и визуализация результатов

### Как происходила фильтрация на GPU?
Описание функции `median_filter_gpu`: 
Функция получает координаты (i, j) текущего потока на GPU с использованием `cuda.grid(2)`.
Далее предусмотрена проверка на краевые пиксели. `if 0 < i < height - 1 and 0 < j < width` - 
данное условие гарантирует, что текущий поток не будет захватывать краевые пиксели. Далее действия аналогичны 
пунктам 3-5 из алгоритма работы для CPU.

Параллельность вычислений в данной функции находится в том, что все потоки GPU обрабатывают различные пиксели изображения. 
Каждый поток отвечает за свой пиксель. 

### Графики времени умножения и ускорения: 
![Графики времени умножения и ускорения](https://github.com/vmokook/HPC-2023/blob/main/Salt_and_Paper/images/Графики.png)

Вывод: был реализован медианный фильтр для фильтрации шума "соль и перец" на CPU и GPU. Выполнен сравнительный анализ на основе 5 изображений 
разной размерности от 128х128 до 2048х2048. Подсчитано время фильтрации на CPU и GPU данных изображений, а также рассчитано ускорение. 
